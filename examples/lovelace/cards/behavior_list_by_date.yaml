# ------------------------------------------------------------
# PREREQUISITES (install once)
# - HACS installed
# - From HACS → Frontend: install
#     • config-template-card
#     • html-card
# - Settings → Dashboards → Resources → add as "type: module":
#     • /hacsfiles/config-template-card/config-template-card.js
#     • /hacsfiles/html-card/html-card.js
# NOTE: Visual editor is not supported for this card; use YAML mode.
# ------------------------------------------------------------

type: custom:config-template-card
entities:
  # ⬇️ REPLACE <studentID> with your actual one (entity must be: sensor.mashov_<studentID>_homework)
  - sensor.mashov_<studentID>_behavior
card:
  type: custom:html-card
  # Keep this whole string on ONE line. Do not add newlines inside ${ ... }.
  content: "${(function(){var id='sensor.mashov_<studentID>_behavior';var s=states[id];if(!s||!s.attributes){return '<div dir=\"rtl\" style=\"text-align:right;padding:8px;opacity:.8;\">אין נתונים להצגה</div>';}{/* ---- source data ---- */}var by=s.attributes.formatted_by_date||s.attributes.by_date||{};var summary=s.attributes.formatted_summary||s.attributes.summary||'';var student=(s.attributes.student_name||s.attributes['Student name']||s.attributes.student||s.attributes.full_name||s.attributes.name||(s.attributes.friendly_name||'').trim()||'שם תלמיד/ה');{/* ---- collect & sort dates (newest → oldest) ---- */}var rows=[];for(var d in by){if(!Object.prototype.hasOwnProperty.call(by,d))continue;var p=(d||'').split('/');if(p.length<3)continue;var k=parseInt(p[2]+(p[1]||'').padStart(2,'0')+(p[0]||'').padStart(2,'0'));rows.push({k:k,d:d,items:by[d]||[]});}rows.sort(function(a,b){return b.k-a.k;});if(!rows.length){return '<div dir=\"rtl\" style=\"text-align:right;padding:8px;opacity:.8;\">אין נתונים להצגה</div>';}{/* ---- settings ---- */}var limit=5;var pal=['#f44336','#e91e63','#9c27b0','#673ab7','#3f51b5','#2196f3','#03a9f4','#00bcd4','#009688','#4caf50','#8bc34a','#cddc39','#ffeb3b','#ffc107','#ff9800','#ff5722','#795548','#607d8b'];{/* ---- build HTML (RTL) ---- */}var title='התנהגות — '+student;var out='<div dir=\"rtl\" style=\"text-align:right;\"><h3 style=\"margin:0 0 8px;font-size:16px;\">'+title+'</h3><div style=\"opacity:.8;margin-bottom:10px;\">'+summary+'</div>';for(var i=0;i<rows.length&&i<limit;i++){var row=rows[i];out+='<details'+(i===0?' open':'')+' dir=\"rtl\" style=\"margin:10px 0;border:1px solid rgba(0,0,0,.08);border-radius:10px;padding:10px;\"><summary style=\"list-style:none;cursor:pointer;display:flex;flex-direction:row-reverse;gap:8px;align-items:center;font-weight:700;\"><span>'+row.d+'</span><span style=\"opacity:.7;\">('+row.items.length+' פריטים)</span></summary>';for(var j=0;j<row.items.length;j++){var it=row.items[j]||'';var parts=it.split(':');var left=parts[0]||'';var body=(parts.length>1?parts.slice(1).join(':'):'').trim();/* left looks like 'שיעור X - SUBJECT' */var subj=left.split('-').slice(-1)[0].trim();var lesson=left.replace('שיעור','').split('-')[0].trim();/* stable color per subject */var key=subj.toLowerCase().trim(),acc=0;for(var c=0;c<key.length;c++){acc=(acc*31+key.charCodeAt(c))>>>0;}var color=pal[acc%pal.length];var letter=(subj.trim().charAt(0)||'•');out+='<div style=\"display:flex;flex-direction:row-reverse;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid rgba(0,0,0,.06);\"><div style=\"width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;background:'+color+';\">'+letter+'</div><div style=\"flex:1;\"><div style=\"font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;\">'+subj+'</div><div style=\"font-size:12px;opacity:.8;\">שיעור '+lesson+' — '+body+'</div></div></div>'; } out+='</details>'; } if(rows.length>limit){out+='<div style=\"direction:rtl;text-align:right;opacity:.7;font-size:12px;margin-top:6px;\">... ועוד '+(rows.length-limit)+' תאריכים</div>'; } out+='</div>';return out;})()}"
